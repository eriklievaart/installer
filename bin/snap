#!/bin/sh
set -e

id=$(xprop -root | sed -r -n '/ACTIVE_WINDOW\(/{s|[^#]*# ?0x||;p}')
line=$(wmctrl -l -G | grep "$id")
x=$(echo "$line" | awk '{print $3}')
y=$(echo "$line" | awk '{print $4}')
width=$(echo "$line" | awk '{print $5}')
height=$(echo "$line" | awk '{print $6}')
midx=$(expr $width "/" 2 + $x)

for bounds in $(xrandr | grep " connected " | sed -n -r 's/.*connected ?([^ ]*).*/\1/;p')
do
	if expr "${bounds?}" : ".*+0+0" > /dev/null;
	then
		d1x=$(echo "${bounds?}" | cut -d + -f 2)
		d1y=$(echo "${bounds?}" | cut -d + -f 3)
		d1w=$(echo "${bounds?}" | cut -d x -f 1)
		d1h=$(echo "${bounds?}" | tr '+' 'x' | cut -d x -f 2)
	else
		d2x=$(echo "${bounds?}" | cut -d + -f 2)
		d2y=$(echo "${bounds?}" | cut -d + -f 3)
		d2w=$(echo "${bounds?}" | cut -d x -f 1)
		d2h=$(echo "${bounds?}" | tr '+' 'x' | cut -d x -f 2)
	fi
done

echo "id $id position $x $y $width $height"
echo "midx = $midx"
echo "display 1: $d1x    $d1y $d1w $d1h"
echo "display 2: $d2x $d2y $d2w $d2h"

if expr $midx '<=' $d1w > /dev/null; then
	echo "we be on display 1"
	dx=$d1x
	dy=$d1y
	dw=$d1w
	dh=$d1h
	display=1
else
	echo "we be on display 2"
	dx=$d2x
	dy=$d2y
	dw=$d2w
	dh=$d2h
	display=2
fi

dw2=$(expr $dw "/" 2)
dh2=$(expr $dh "/" 2)
dx2=$(expr $dx + $dw2)
dy2=$(expr $dy + $dh2)


move() {
	echo "snap $1 $2 $3 $4"
	wmctrl -r :ACTIVE: -e "0,$1,$2,$3,$4"
	echo ""
}

x=$dx
y=$dy
w=$dw
h=$dh

while expr "$#" '>' 0
do
	case "$1" in
        	-f) wmctrl -r :ACTIVE: -b toggle,fullscreen; exit 0;;
        	-l) w=$dw2;;
	        -r) x=$dx2; w=$dw2;;
	        -t) h=$dh2;;
	        -b) y=$dy2; h=$dh2;;
	esac
	shift
done

wmctrl -r :ACTIVE: -b remove,maximized_vert,maximized_horz;
wmctrl -r :ACTIVE: -b remove,fullscreen;
echo "snap $x $y $w $h"
wmctrl -r :ACTIVE: -e "0,$x,$y,$w,$h"





