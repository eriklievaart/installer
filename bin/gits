#!/bin/sh
# script to run git commands on multiple git repos simultaneously

YELLOW='\033[1;33m'
RED='\033[1;31m'
PLAIN='\033[0m'


if [ "$1" = "-c" ]; then
	message=$(echo "$@" | sed 's/^-c *//')
	if [ -z "$message" ]; then
		echo "$RED    git commit message required! $PLAIN"
		exit 500
	fi
fi


if [ "$(echo "$1" | cut -c 1)" = "@" ]; then
	repo=$(echo "$1" | sed 's/@//')
	if [ -d ~/Development/git/$repo ]; then
		cd ~/Development/git/$repo
		echo $PWD
		shift
		git "$@"
		exit 0
	else
		echo "$RED repo $repo does not exist $PLAIN"
		exit 404
	fi
fi


for dir in $(ls ~/Development/git)
do
	cd ~/Development/git/$dir
	if [ ! -d ".git" ]; then
		continue
	fi

	color=""
	branch=$(git status | sed '/^On branch.*/!d; s/^On branch //')
	untracked=$(git status | sed '/^Untracked.*/!d; s/ntracked.*//')
	changes=$(git status | sed '/^Changes.*/!d; s/hanges.*//')
	
	if [ ! -z "$untracked$changes" ]; then
		color=$YELLOW
	fi
	
	echo "$color[$branch] $dir $untracked$changes$PLAIN"

	
	if [ "$1" = "-c" ]; then
		if [  ! -z "$untracked$changes" ]; then
			git add --all
			git commit -m "$message"
			git push
			echo ''
		fi

	elif [ "$#" -gt 0 ]; then
		git "$@"
		echo
	fi
done

